<!DOCTYPE html>
<html lang="en">
<head>
    <script src="https://unpkg.com/konva@9/konva.min.js"></script>

    <link rel="stylesheet" href="style.css">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Video Player</title>
  <script src="addrect.js"></script>
  <script src="play.js"></script>
  <style>
   
  </style>
</head>
<body>
  <div>
  <input type="file" accept="video/audio" id="videoInput">
</div>
<div  id="container"></div>
  <div>
  <button onclick="play1()">Play</button>
  <button onclick="pause()">Pause</button>
  <label>Seek Time:</label><input id = "seektime" type="text">
  <button onclick="seek()">Time Update</button>
  <button onclick="addrect()">addrect</button>

 
</div>
<div style="margin-top: 10px;">
 <label>Id:</label> <input id = "id1" type="text">
 <label>Start Time:</label><input id = "starttime" type="text">
 <label>Current Time:</label><input id = "currenttime" type="text">
 <label>Duration:</label><input id = "duration" type="text">
 <button onclick="editclip()">Submit</button>
</div>

 <p id = "time"></p>

  <ul id="list">


  </ul>


  <script>
    var videos = [];
    var shapes=[]
    var time = 1;
    var setinterval;
    var totaltime = 0;
    var currenttime;
    var checkplay2 = false;
    var isPaused = true;

    var videocurrenttime = 0;
    var videoid = 0;
    var videoelement;
    var animationframe;

    var ispaused = false

    var playpromise;

    var stage = new Konva.Stage({
        container: 'container',
        width: 300,
    height: 300,
             });

      var layer
      var videoImage

    document.addEventListener("DOMContentLoaded", function() {
      var videoInput = document.getElementById("videoInput");

      videoInput.addEventListener("change", function() {
        var file = this.files[0];
        if (file) {
          pushFile(file);
        }
      });
    });

    function pushFile(file) {
      var objectURL = URL.createObjectURL(file);

      var tempVideo = document.createElement('video');
      tempVideo.src = objectURL;
      tempVideo.id = videoid;
      tempVideo.type = "video"

      videoid++;

      

      tempVideo.addEventListener('loadedmetadata', function(event) {
       
     tempVideo.starttime = 0
        tempVideo.currenttime = 0;
        tempVideo.maxduration = tempVideo.duration;
        tempVideo.currentduration = tempVideo.duration



        stage.width(tempVideo.videoWidth/5),
    stage.height(tempVideo.videoHeight/5),
            
 document.getElementById("container").style.width = tempVideo.videoWidth/5 + "px"
 document.getElementById("container").style.height = tempVideo.videoHeight/5 + "px"

            
        videoImage = new Konva.Image({
    width: tempVideo.videoWidth/5,
    height: tempVideo.videoHeight/5,
    draggable: true,
  });
  layer = new Konva.Layer();    
 stage.add(layer)



 


        tempVideo.addEventListener("play", (event)=>{

            if(ispaused === true){
for (i=0;i<videos.length;i++){

    videos[i].currentTime = videos[i].currenttime+time;
}

ispaused= false

}
       })

   
       

        tempVideo.addEventListener("timeupdate", timeupdate1);

        tempVideo.addEventListener("pause", (event) => {

            event.target.pause()
          var array1 = [];

          for (i = 0; i < videos.length; i++) {
            array1.push(videos[i].starttime + videos[i].currentduration);
          }
        
          totaltime = Math.max.apply(null, array1);
          if (time >= parseInt(totaltime)) {
            clearInterval(setinterval);
            cancelAnimationFrame(animationframe)
            time = 1;
          }
        });

        tempVideo.addEventListener("ended", (event) => {

           
          var array1 = [];

          for (i = 0; i < videos.length; i++) {
            array1.push(videos[i].starttime + videos[i].currentduration);
          }
        
          totaltime = Math.max.apply(null, array1);
          if (time >= parseInt(totaltime)) {
            clearInterval(setinterval);
            cancelAnimationFrame(animationframe)
            time = 1;
          }
        });

        videos.push(tempVideo);

        if(videos.length>0){
             document.getElementById("list").innerHTML = " "
            for(i=0;i<videos.length;i++){

            var lielement = document.createElement("li")
            lielement.id = videos[i].id
            lielement.innerHTML = "id: "+videos[i].id + " | " + "Start Time: " + videos[i].starttime + " | " + "Current Time: " + videos[i].currenttime + " | " + "Duration: " + videos[i].currentduration

            lielement.addEventListener("dblclick", (event)=>{
                for(i=0;i<videos.length;i++){

                    if(videos[i].id ===event.target.id){

                        videos.splice(i, 1)
                    }
                }
event.target.remove();
            })

var list = document.getElementById("list")
list.appendChild(lielement)
        }}
      });
    }



    function seek() {
      checkplay2 = true;
      var seektime = parseFloat(document.getElementById("seektime").value)
      time = seektime
      for(i=0;i<videos.length;i++){

        videos[i].currentTime = seektime+videos[i].currenttime
      }
    }

    function pause() {

        ispaused = true;
      clearInterval(setinterval);
      cancelAnimationFrame(animationframe)

      for(i=0;i<videos.length;i++){
videos[i].removeEventListener("timeupdate", timeupdate1)
videos[i].pause();

      }
     
    }

    function timeupdate1(event) {

        var x = 0
     
if (time >= event.target.starttime + event.target.currentduration) {


    if (playpromise !== undefined) {
playpromise.then(() => {
    event.target.pause()
         event.target.remove();
    })
    .catch(error => {
     
    });
  }


   

        
       
        
      }
    }

function editclip(){

  clearInterval(setinterval)

  var id1 = parseInt(document.getElementById("id1").value)
  var starttime= parseInt(document.getElementById("starttime").value)
    var currenttime = parseFloat(document.getElementById("currenttime").value)
    var duration = parseFloat(document.getElementById("duration").value)
  for(i=0;i<videos.length; i++){
videos[i].pause()

   
if(parseInt(videos[i].id) === id1){

   videos[i].starttime = starttime
    videos[i].currenttime = currenttime
  videos[i].currentduration = duration
}
  }

  if(videos.length>0){
             document.getElementById("list").innerHTML = " "
            for(i=0;i<videos.length;i++){

            var lielement = document.createElement("li")
            lielement.id = videos[i].id
            lielement.innerHTML = "id: "+videos[i].id + " | " + "Start Time: " + videos[i].starttime + " | " + "Current Time: " + videos[i].currenttime + " | " + "Duration: " + videos[i].currentduration

            lielement.addEventListener("dblclick", (event)=>{
                for(i=0;i<videos.length;i++){

                    if(videos[i].id ===event.target.id){

                        videos.splice(i, 1)
                    }
                }
event.target.remove();
            })

var list = document.getElementById("list")
list.appendChild(lielement)
        }}

}
  </script>
</body>
</html>
